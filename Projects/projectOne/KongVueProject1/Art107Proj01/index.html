<!DOCTYPE html>
<html>
  <head>
    <script src="../p5.min.js"></script>
    <script src="../addons/p5.dom.js"></script>
    <script src="../addons/p5.dom.min.js"></script>
    <script src="../addons/p5.sound.min.js"></script>
    <script src="sketch.js"></script>
    <script>

    var jsonFile;

   

    var url1 = 'https://api.nasa.gov/neo/rest/v1/feed?start_date=';
    var startDate =[];// = '2017-09-07';//2017-09-07&
    var EndDate = [];// = '2017-09-08';//2017-09-08&
    var url2 = 'api_key=uJ0pfx69sqP2aMxcWIFScOvwSz8V9HMrMapNuQU2';
    var strDate,edDate;
    var diam = [];
    var starW = [];
    var starH = [];

    //ball position an speed array
    var ranX = [];
    var ranY = [];
    var speedX = [];
    var speedY = [];

    //ball size
    var size = [];
    
    var num;
    var numArray = [];
    var r = 255;
    var g = 165;
    var b = 0;
    var t = [];
    var t2 = [];
    	



    //easing test
    var targetX;
    var targetY;
    var dx;
    var dy;

    var x = 0;
    var y = 0;
    var easing = 0.5;
    var test = false;

    function setup(){
    	// 
    createCanvas(windowWidth, windowHeight);
    noStroke();
    


    background(0);

    //fill(255,255,255);
        for (var i = 0; i <500; i++) {
            starW[i] = random(windowWidth);
            starH[i] = random(windowHeight);
            t2[i] = random(105,255);
        }

    strDate = createInput('2015-09-07');
    strDate.position(100, 20);

    edDate = createInput('2015-09-08');
    edDate.position(100, 40);
    

    var button = select('submit');
    button = createButton('Submit');
    button.position(100, 60);
    button.mousePressed(askDate);
    	
    }

    function askDate() {
         var url = url1 + strDate.value() + '&end_date=' + edDate.value() + '&' + url2;

         console.log(url);
         loadJSON(url, gotData);
       
      
    }


    function gotData(data){
    jsonFile = data;
    num = data.element_count;
    for (var i = 0; i < num; i++) {
        ranX[i] = random(windowWidth);
        ranY[i] = random(windowHeight);
        speedX[i] = random(-3,3);
        speedY[i] = random(-3,3);
        size[i] = random(45);
        t[i] = random(110,255);
    }
    
    // console.log(data["near_earth_objects"][edDate.value()][0]["estimated_diameter"]["feet"]["estimated_diameter_max"]);//
    // for (i in data["near_earth_objects"][edDate.value()]) {
        
    //     diam[i] = Math.round(data["near_earth_objects"][edDate.value()][i]["estimated_diameter"]["feet"]["estimated_diameter_max"]);

    //  for (j in data["near_earth_objects"][edDate.value()][i]["close_approach_data"]) {
    //         fromEarth[i] = data["near_earth_objects"][edDate.value()][i]["close_approach_data"][j]["miss_distance"]["miles"];
            
    //     }

    // }

   
    //console.log(diam);
    //console.log(fromEarth);

    }

    function mousePressed() {
    //if (value == 255){
      test = true;
      //value = 20;
    //}

  }

  function mouseReleased(){
    //if (value == 20){
      //value = 255;
      test = false;
    //}
  }

    function windowResized() {
    resizeCanvas(windowWidth, windowHeight);

    }

    function draw(){
        background(0);
        //stars
        for (var i = 0; i <starW.length; i++) {
            fill(255,255,255,t2[i]);
          ellipse(starW[i],starH[i],2,2);
        }

        textSize(15);
        fill(0, 102, 153);
        text("Start Date", 10, 20);
        text("End Date", 10, 40);
        text("Intsructions: Enter two dates with \n\ a maximum of 7 days in between \n\ to draw total astroids found.", 10, 100);


        fill(255,255,0);
                ellipse(windowWidth/2,windowHeight/2,580,580);
     

        if(jsonFile){

              
            for (var i = 1; i <=num; i ++) {
            //fill(value);

            if(test == true){
              targetX = mouseX;
              dx = targetX - ranX[i];
              ranX[i] += dx * easing;
              
              targetY = mouseY;
              dy = targetY - ranY[i];
              ranY[i] += dy * easing;
            fill(255,165,0,t[i])
            ellipse(ranX[i], ranY[i], size[i], size[i]);
        }
            else{
            fill(255,165,0,t[i])
            ellipse(ranX[i], ranY[i], size[i], size[i]);
            //ellipse(ball_x[i-1], ball_y[i-1], 10, 10);
            //mouseClicked(changeGray);

            ranX[i] += speedX[i];
            ranY[i] += speedY[i];

            if (ranX[i] >= windowWidth - size[i]/2) 
              speedX[i] = -speedX[i];

            // if (ball_x[i] = 100) 
            //   ball_dx[i] = -ball_dx[i];
            // if (ball_y[i] = 100) 
            //   ball_dy[i] = -ball_dy[i];

            if (ranY[i] >= windowHeight - size[i]/2) 
              speedY[i] = -speedY[i];

            if (ranX[i] <= size[i]/2) 
              speedX[i] = -speedX[i];

            if (ranY[i] <= size[i]/2) 
              speedY[i] = -speedY[i];
        }
      }
  }
        //stars
        
        


        fill(50,205,50);
        //noStroke();
        ellipse(windowWidth/2,windowHeight/2,90,90);
        fill(255,69,50, random(0,255));
        ellipse(windowWidth/2,windowHeight/4,7,7);
        
    
    }

    </script>
    <style> body {padding: 0; margin: 0;} </style>
  </head>
  <body>
    <p>
        <!-- Start Date: <input type="text" name="startdate" value="2017-09-07"><br>
        End Date: <input type="text" name="enddate" value="2017-09-08"><br> -->
        <!-- <input type="submit" value="Submit"> -->

    </p>
  </body>
</html>